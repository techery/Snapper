box: wercker/android
# Build definition
build:
    # The steps that will be executed on build
    steps:
        - script:
            name: prepare env variables
            code: |
                ANDROID_TARGET=android-21
                ANDROID_ABI=armeabi-v7a
        - script:
            name: show base information
            code: |
                gradle -v
                echo $ANDROID_HOME
                echo $ANDROID_SDK_VERSION
                echo $ANDROID_BUILD_TOOLS
                echo $ANDROID_UPDATE_FILTER
                echo $ANDROID_NDK_HOME
                echo $ANDROID_TARGET
                echo $ANDROID_ABI
        - android-sdk-update:
            filter: sys-img-$ANDROID_ABI-$ANDROID_TARGET
        - setup-android-emulator:
            target: $ANDROID_TARGET
        - script:
            name: run gradle connectedCheck
            code: |
                gradle --parallel -q --project-cache-dir=$WERCKER_CACHE_DIR connectedCheck
        - script:
            name: run gradle build
            code: |
                gradle --parallel -q --project-cache-dir=$WERCKER_CACHE_DIR --full-stacktrace build
    after-steps:
        - wantedly/pretty-slack-notify:
            webhook_url: $SLACK_WEBHOOK_URL
